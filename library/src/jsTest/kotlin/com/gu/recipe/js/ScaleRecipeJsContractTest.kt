package com.gu.recipe.js

import kotlin.test.Test
import kotlin.test.assertEquals

class ScaleRecipeJsContractTest {
    @Test
    fun `ensure the js glue can parse and serialise`() {
        val recipeJson = """{"isAppReady": false, "id": "f0d621db36a943769a203c85e3687169", "canonicalArticle": "lifeandstyle/2018/may/13/ofm-classic-cookbook-sri-owen-the-rice-book-bee-wilson", "composerId": "5ae9c469e4b06754a53019d9", "webPublicationDate": null, "title": "Biryani with stuffed morels", "description": "Choose large morels so that you can get more stuffing into each one.", "serves": [{"amount": {"min": 2.0, "max": 2.0}, "unit": "people", "text": "For 2 people as a one-dish meal"}], "featuredImage": {"url": "https://i.guim.co.uk/img/media/28046d87c67fd2e36e018d8799d5119fac90c00e/498_391_4817_6018/master/4817.jpg?width=1600&dpr=1&s=none", "mediaId": "28046d87c67fd2e36e018d8799d5119fac90c00e", "cropId": "498_391_4817_6018", "source": "The Observer", "photographer": "Romas Foord", "imageType": "Photograph", "caption": "Biryani with stuffed morels \nThe Rice Book by Sri Owen \nClassic cookbook \nProp and food styling: Polly Webb-Wilson \nObserver Food Monthly\nOFM", "width": 1601, "height": 2000}, "timings": [], "instructions": [{"stepNumber": 1, "description": "Before you start, soak the rice in cold water for {\"min\": 30, \"unit\": \"minutes\", \"scale\": false} or a bit longer.", "images": null}], "instructionsTemplate": [{"stepNumber": 1, "descriptionTemplate": "Before you start, soak the rice in cold water for {\"min\": 30, \"unit\": \"minutes\", \"scale\": false} or a bit longer.", "images": null}], "contributors": [], "byline": ["Sri Owen"], "ingredients": [{"ingredientsList": [{"amount": {"max": 225, "min": 225}, "emptyAmountIsOk": false, "name": "basmati", "optional": false, "suffix": "or other good long grain rice", "text": "basmati, or other good long grain rice 225 g", "unit": "g"}], "recipeSection": "For the rice"}], "ingredientsTemplate": [{"ingredientsList": [{"text": "basmati, or other good long grain rice 225 g", "template": "basmati, or other good long grain rice {\"min\": 225, \"unit\": \"g\", \"scale\": true}", "name": "basmati", "ingredientID": null, "amount": {"min": 225, "max": 225}, "unit": "g", "optional": false, "prefix": null, "suffix": "or other good long grain rice"}], "recipeSection": "For the rice"}], "celebrationIds": [], "cuisineIds": ["indonesian"], "mealTypeIds": ["dinner"], "suitableForDietIds": ["meat-free", "gluten-free", "pescatarian", "vegetarian"], "utensilsAndApplianceIds": [], "techniquesUsedIds": []}"""
        val expectedJson = """{"byline":["Sri Owen"],"canonicalArticle":"lifeandstyle/2018/may/13/ofm-classic-cookbook-sri-owen-the-rice-book-bee-wilson","celebrationIds":[],"composerId":"5ae9c469e4b06754a53019d9","contributors":[],"cuisineIds":["indonesian"],"description":"Choose large morels so that you can get more stuffing into each one.","featuredImage":{"caption":"Biryani with stuffed morels \nThe Rice Book by Sri Owen \nClassic cookbook \nProp and food styling: Polly Webb-Wilson \nObserver Food Monthly\nOFM","cropId":"498_391_4817_6018","imageType":"Photograph","mediaId":"28046d87c67fd2e36e018d8799d5119fac90c00e","photographer":"Romas Foord","source":"The Observer","url":"https://i.guim.co.uk/img/media/28046d87c67fd2e36e018d8799d5119fac90c00e/498_391_4817_6018/master/4817.jpg?width=1600&dpr=1&s=none"},"id":"f0d621db36a943769a203c85e3687169","ingredients":[{"ingredientsList":[{"amount":{"max":225,"min":225},"name":"basmati","optional":false,"suffix":"or other good long grain rice","text":"basmati, or other good long grain rice 225 g","unit":"g"}],"recipeSection":"For the rice"}],"instructions":[{"description":"Before you start, soak the rice in cold water for 30 minutes or a bit longer.","stepNumber":1}],"isAppReady":false,"mealTypeIds":["dinner"],"serves":[{"amount":{"max":2,"min":2},"text":"For 2 people as a one-dish meal","unit":"people"}],"suitableForDietIds":["meat-free","gluten-free","pescatarian","vegetarian"],"techniquesUsedIds":[],"timings":[],"title":"Biryani with stuffed morels","utensilsAndApplianceIds":[]}"""

        val scaledJson = scaleRecipe(recipeJson, 1.0f, "Metric")
        assertEquals(scaledJson, expectedJson)
    }
}